<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›‘ ãƒ•ãƒ«è£…å‚™ ASTé›£èª­åŒ–ãƒ„ãƒ¼ãƒ«</title>
<style>
body { font-family: 'Consolas', monospace; background: #101010; color: #0f0; padding: 20px; }
.container { max-width: 1100px; margin: auto; background: #000; padding: 20px; border: 1px solid #0f0; border-radius: 8px; }
h1 { text-align:center; color:#fff; text-shadow: 0 0 10px #0f0; }
textarea, pre { width: 100%; background:#181818; color:#ccc; border:1px solid #333; padding:15px; box-sizing:border-box; font-family:inherit; }
textarea { min-height:180px; }
.controls { display:flex; gap:10px; margin:15px 0; justify-content:center; flex-wrap:wrap; }
button { padding:10px 20px; cursor:pointer; background:#003300; color:#0f0; border:1px solid #0f0; font-weight:bold; transition:0.2s; }
button:hover { background:#005500; box-shadow:0 0 10px #0f0; }
.options { display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:10px; padding:10px; border:1px solid #333; margin-bottom:15px; background:#0a0a0a; }
label { display:flex; align-items:center; cursor:pointer; user-select:none; }
input[type="checkbox"] { accent-color:#0f0; margin-right:6px; }
#statusText { font-weight:bold; margin-left:10px; }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ›‘ ãƒ•ãƒ«è£…å‚™ ASTé›£èª­åŒ–ãƒ„ãƒ¼ãƒ«</h1>
  <textarea id="input" placeholder="// JavaScriptã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«"></textarea>

  <div class="options">
    <label>å±¤æ•°: <input type="range" id="layers" min="1" max="5" value="1"> <span id="layerVal">1</span></label>
    <label><input type="checkbox" id="renameVars" checked>å¤‰æ•°/é–¢æ•°åãƒªãƒãƒ¼ãƒ </label>
    <label><input type="checkbox" id="stringBase64" checked>æ–‡å­—åˆ— Base64åŒ–</label>
    <label><input type="checkbox" id="stringHex">æ–‡å­—åˆ— \xHHåŒ–</label>
    <label><input type="checkbox" id="numberHex" checked>æ•°å€¤16é€²åŒ–</label>
    <label><input type="checkbox" id="removeComments">ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤</label>
    <label><input type="checkbox" id="wrapEval">Evalåœ§ç¸®/IIFEãƒ©ãƒƒãƒ—</label>
  </div>

  <div class="controls">
    <button onclick="processObfuscation()">ğŸ’€ é›£èª­åŒ–</button>
    <button onclick="copyToClip()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    <button onclick="downloadCode()">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    <button onclick="runTest()" style="border-color:#f55; color:#fcc;">ğŸš¨ å®Ÿè¡Œãƒ†ã‚¹ãƒˆ</button>
  </div>

  <div>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span id="statusText">å¾…æ©Ÿä¸­</span></div>
  <pre id="output"></pre>
</div>

<!-- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ2025å¹´11æœˆ22æ—¥ çµ¶å¯¾å‹•ãç‰ˆï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/acorn@8/dist/acorn.js"></script>
<script src="https://cdn.jsdelivr.net/npm/estraverse@4.3.0/estraverse.js"></script>
<script src="https://cdn.jsdelivr.net/npm/escodegen@2/escodegen.js"></script>
  
<script>
let finalCode = "";

function obfuscateCode(source, options={}) {
  const { renameIdentifiers=true, stringBase64=true, stringHex=false, numberHex=true, removeComments=false } = options;
  const ast = acorn.parse(source, { ecmaVersion:'latest', sourceType:'module', locations:true, onComment:removeComments?()=>{}:null });

  const scopeStack = [];
  function pushScope(){ scopeStack.push({ nameMap:new Map(), counter:0 }); }
  function popScope(){ scopeStack.pop(); }
  function currentScope(){ return scopeStack[scopeStack.length-1]; }
  function genName(scope){ return `_0x${scope.counter++}`; }

  estraverse.replace(ast, {
    enter(node, parent) {
      if(node.type==='Program'||node.type==='FunctionDeclaration'||node.type==='FunctionExpression'||node.type==='ArrowFunctionExpression'){
        pushScope();
        if(node.params){
          for(const param of node.params){
            if(param.type==='Identifier'){
              const newName=genName(currentScope());
              currentScope().nameMap.set(param.name,newName);
              param.name=newName;
            }
          }
        }
        if(node.type==='FunctionDeclaration' && node.id){
          const newName=genName(currentScope());
          currentScope().nameMap.set(node.id.name,newName);
          node.id.name=newName;
        }
      }

      if(renameIdentifiers && node.type==='VariableDeclarator' && node.id.type==='Identifier'){
        const newName=genName(currentScope());
        currentScope().nameMap.set(node.id.name,newName);
        node.id.name=newName;
      }

      if(renameIdentifiers && node.type==='Identifier'){
        const name=node.name;
        for(let i=scopeStack.length-1;i>=0;i--){
          const scope=scopeStack[i];
          if(scope.nameMap.has(name)){ node.name=scope.nameMap.get(name); break; }
        }
      }

      if(node.type==='Literal'){
        if(typeof node.value==='string'){
          if(stringBase64){ node.value=btoa(node.value); node.raw=`"${btoa(node.value)}"`; }
          else if(stringHex){ 
            let out=''; for(let i=0;i<node.value.length;i++){ out+='\\x'+node.value.charCodeAt(i).toString(16).padStart(2,'0'); }
            node.value=out; node.raw=`"${out}"`;
          }
        } else if(typeof node.value==='number' && numberHex){
          node.raw='0x'+node.value.toString(16);
        }
      }
    },
    leave(node){
      if(node.type==='Program'||node.type==='FunctionDeclaration'||node.type==='FunctionExpression'||node.type==='ArrowFunctionExpression'){
        popScope();
      }
    }
  });

  let code = escodegen.generate(ast,{format:{indent:{style:'  '},semicolons:true}});
  if(options.wrapEval) code = `eval(${JSON.stringify(code)})`;
  return code;
}

function multiLayerObfuscate(source, layers=1, options={}) {
  let code=source;
  for(let i=0;i<layers;i++){ code=obfuscateCode(code, options); }
  return code;
}

function processObfuscation(){
  const input=document.getElementById('input').value;
  if(!input.trim()) return alert("ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  const layers=parseInt(document.getElementById('layers').value);
  const options = {
    renameIdentifiers:document.getElementById('renameVars').checked,
    stringBase64:document.getElementById('stringBase64').checked,
    stringHex:document.getElementById('stringHex').checked,
    numberHex:document.getElementById('numberHex').checked,
    removeComments:document.getElementById('removeComments').checked,
    wrapEval:document.getElementById('wrapEval').checked
  };
  const status=document.getElementById('statusText');
  status.textContent="å‡¦ç†ä¸­..."; status.style.color="#ff0";
  setTimeout(()=>{
    try{
      finalCode=multiLayerObfuscate(input,layers,options);
      document.getElementById('output').textContent=finalCode;
      status.textContent="âœ… å®Œäº†"; status.style.color="#0f0";
    }catch(e){
      console.error(e);
      status.textContent="âŒ ã‚¨ãƒ©ãƒ¼:"+e.message; status.style.color="#f55";
    }
  },20);
}

function copyToClip(){navigator.clipboard.writeText(finalCode);document.getElementById('statusText').textContent="ã‚³ãƒ”ãƒ¼å®Œäº†";}
function downloadCode(){ const blob=new Blob([finalCode],{type:'text/javascript'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='obfuscated.js'; a.click(); }
function runTest(){ if(!finalCode) return; try{ const log=console.log; let output=""; console.log=(...args)=>{output+=args.join(" ")+"\n";log(...args)}; new Function(finalCode)(); console.log=log; alert(output?"å®Ÿè¡ŒæˆåŠŸï¼\n"+output:"å®Ÿè¡ŒæˆåŠŸï¼(ãƒ­ã‚°ãªã—)"); }catch(e){alert("å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼:\n"+e.message);} }

document.getElementById('layers').addEventListener('input', e=>document.getElementById('layerVal').textContent=e.target.value);
</script>
</body>
</html>
