<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS é›£èª­åŒ–ãƒ„ãƒ¼ãƒ« (ã‚·ãƒ³ã‚°ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ç‰ˆ)</title>
    
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f7f6;
            color: #333;
        }

        h1 {
            color: #007bff;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }

        h3 {
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 25px;
        }

        textarea {
            width: 90%;
            max-width: 800px;
            display: block;
            margin-bottom: 10px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ccc;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background: #0056b3;
        }

        #copyButton {
            background: #28a745;
        }

        #copyButton:hover {
            background: #1e7e34;
        }

        .options {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #fff;
        }

        .options label {
            margin-right: 20px;
            font-weight: normal;
        }
    </style>
</head>
<body>

    <h1>JS é›£èª­åŒ–ãƒ„ãƒ¼ãƒ« (é‡ã­ãŒã‘)</h1>
    <p>Terser (æœ€å°åŒ–) â†’ javascript-obfuscator (å®¹é‡åˆ¶ç´„ç‰ˆ) â†’ ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ ã®é †ã§å‡¦ç†ã—ã¾ã™ã€‚</p>

    <h3>å…¥åŠ›ã‚³ãƒ¼ãƒ‰:</h3>
    <textarea id="inputCode" rows="15" placeholder="ã“ã“ã«é›£èª­åŒ–ã—ãŸã„ JavaScript ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›..."></textarea>

    <div class="options">
        <strong>æœ€çµ‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ–¹å¼:</strong>
        <label><input type="radio" name="encoding" value="base64" checked> Base64 (æ¨™æº–ãƒ‡ã‚³ãƒ¼ãƒ€ atob)</label>
        <label><input type="radio" name="encoding" value="base91"> Base91 (åˆ¥é€”ãƒ‡ã‚³ãƒ¼ãƒ€è¦)</label>
    </div>

    <button id="obfuscateButton">é‡ã­ãŒã‘å®Ÿè¡Œ</button>

    <h3>å‡ºåŠ›ã‚³ãƒ¼ãƒ‰ (Function() å®Ÿè¡Œå½¢å¼):</h3>
    
    <button id="copyButton">ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>
    
    <textarea id="outputCode" rows="15" placeholder="é›£èª­åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™" readonly></textarea>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/javascript-obfuscator/4.1.0/index.browser.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/terser/dist/bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/base91-js@1.1.0/lib/base91.min.js"></script>

    <script>
        // ===================================
        // â–¼ é›£èª­åŒ–å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ â–¼
        // ===================================

        document.getElementById('obfuscateButton').addEventListener('click', async function() {
            const inputCode = document.getElementById('inputCode').value;
            const outputCodeElement = document.getElementById('outputCode');
            const selectedEncoding = document.querySelector('input[name="encoding"]:checked').value;

            if (!inputCode.trim()) {
                outputCodeElement.value = "ã‚³ãƒ¼ãƒ‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
                return;
            }

            outputCodeElement.value = `å‡¦ç†ä¸­... (Terser â†’ Obfuscator â†’ ${selectedEncoding})`;

            try {
                // --- 1. Terser (æœ€å°åŒ–ãƒ»åœ§ç¸®) ---
                const terserResult = await Terser.minify(inputCode, {
                    mangle: true,
                    compress: true
                });

                if (terserResult.error) {
                    throw new Error('Terser Minify Error: ' + terserResult.error.message);
                }
                const minifiedCode = terserResult.code;

                // --- 2. javascript-obfuscator (é›£èª­åŒ–: å®¹é‡åˆ¶ç´„ç‰ˆ) ---
                // å®¹é‡ã‚’1.5å€ã¾ã§ã«æŠ‘ãˆã‚‹ãŸã‚ã®è¨­å®š
                const obfuscationResult = JavaScriptObfuscator.obfuscate(minifiedCode, {
                    compact: true,
                    controlFlowFlattening: false,
                    deadCodeInjection: false,
                    selfDefending: true,
                    stringArray: true,
                    stringArrayThreshold: 0.7,
                    identifierNamesGenerator: 'hexadecimal', 
                    unicodeEscapeSequence: true
                });
                
                const obfuscatedAsciiCode = obfuscationResult.getObfuscatedCode();

                // --- 3. æœ€çµ‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ & Function() å½¢å¼ã§å‡ºåŠ›ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ ---
                
                let finalEncodedString = '';
                let outputExecCode = '';
                const base91DecoderURL = 'https://cdn.jsdelivr.net/npm/base91-js@1.1.0/lib/base91.min.js';

                if (selectedEncoding === 'base64') {
                    finalEncodedString = btoa(obfuscatedAsciiCode);
                    
                    outputExecCode = `// å®Ÿè¡Œç”¨ã‚³ãƒ¼ãƒ‰ (Function() ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨)\n` +
                                     `const b64 = "${finalEncodedString}";\n` +
                                     `const code = atob(b64);\n\n` +
                                     `// eval()ã‚„Blobã‚ˆã‚Šç¢ºå®Ÿæ€§ãŒé«˜ãã€ã‚³ãƒ¼ãƒ‰ã‚‚çŸ­ã„æ–¹æ³•\n` +
                                     `const executor = new Function(code);\n` +
                                     `executor();`;

                } else if (selectedEncoding === 'base91') {
                    finalEncodedString = base91.encode(obfuscatedAsciiCode);
                    
                    outputExecCode = `// å®Ÿè¡Œç”¨ã‚³ãƒ¼ãƒ‰ (åˆ¥é€” base91.min.js ãŒå¿…è¦)\n` +
                                     `// <script src="${base91DecoderURL}"></script> ã‚’èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n` +
                                     `const b91 = "${finalEncodedString}";\n` +
                                     `const code = base91.decode(b91);\n\n` +
                                     `// Function() ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨\n` +
                                     `const executor = new Function(code);\n` +
                                     `executor();`;
                }

                outputCodeElement.value = outputExecCode;

            } catch (e) {
                console.error(e);
                outputCodeElement.value = 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n' + e.message;
            }
        });


        // ===================================
        // â–¼ ğŸ“‹ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ â–¼
        // ===================================
        document.getElementById('copyButton').addEventListener('click', function() {
            const outputCodeElement = document.getElementById('outputCode');
            const copyButton = document.getElementById('copyButton');
            
            if (!outputCodeElement.value) {
                copyButton.textContent = 'âŒ ã‚³ãƒ”ãƒ¼å¯¾è±¡ãªã—';
                setTimeout(() => {
                    copyButton.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹';
                }, 1500);
                return;
            }
            
            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ”ãƒ¼ã‚’å®Ÿè¡Œ
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(outputCodeElement.value)
                    .then(() => {
                        copyButton.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                        setTimeout(() => {
                            copyButton.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Copy failed using clipboard API:', err);
                        copyButton.textContent = 'âŒ ã‚³ãƒ”ãƒ¼å¤±æ•— (æ‰‹å‹•ã§é¸æŠã—ã¦ãã ã•ã„)';
                        setTimeout(() => {
                            copyButton.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹';
                        }, 2000);
                    });
            } else {
                // å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆexecCommandï¼‰
                outputCodeElement.select(); 
                document.execCommand('copy');
                copyButton.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼(Legacy)';
                setTimeout(() => {
                    copyButton.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹';
                }, 2000);
            }
        });
    </script>

</body>
</html>
