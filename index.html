<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layered JS Obfuscator (High Security)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 1000px; margin-top: 50px; }
        textarea { background-color: #161b22; color: #79c0ff; border: 1px solid #30363d; font-family: 'Consolas', monospace; font-size: 14px; }
        textarea:focus { background-color: #1f2428; color: #79c0ff; border-color: #58a6ff; outline: none; box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3); }
        .btn-primary { background-color: #238636; border: none; }
        .btn-primary:hover { background-color: #2ea043; }
        .card { background-color: #161b22; border: 1px solid #30363d; }
        h2 { border-bottom: 1px solid #30363d; padding-bottom: 15px; margin-bottom: 20px; }
        .badge-layer { font-size: 0.8em; margin-left: 10px; vertical-align: middle; }
    </style>
</head>
<body class="pb-5">

<div class="container">
    <h2>
        ğŸ›¡ï¸ Dual-Layer Obfuscator
        <span class="badge bg-secondary badge-layer">Core: JS-Obfuscator</span>
        <span class="badge bg-info text-dark badge-layer">Shell: LZ-String</span>
    </h2>
    <p class="text-secondary mb-4">
        æœ‰åãªé›£èª­åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«åŠ ãˆã€åœ§ç¸®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹ã€Œã‚«ãƒ—ã‚»ãƒ«åŒ–ã€ã‚’è¡Œã„ã€è‡ªå‹•è§£æãƒ„ãƒ¼ãƒ«(Deobfuscator)ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚
    </p>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">å…¥åŠ›ã‚³ãƒ¼ãƒ‰ (Source)</label>
            <textarea id="inputCode" class="form-control" rows="15" placeholder="const secret = 'my_api_key'; console.log(secret);"></textarea>
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">é›£èª­åŒ–æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ (Output)</label>
            <textarea id="outputCode" class="form-control" rows="15" readonly></textarea>
        </div>
    </div>

    <div class="card p-3 mb-4">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="enableLzString" checked>
            <label class="form-check-label" for="enableLzString">
                <strong>LZ-Stringåœ§ç¸®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é©ç”¨ (æ¨å¥¨)</strong><br>
                <small class="text-muted">ã‚³ãƒ¼ãƒ‰ã‚’ä¸å¯èª­ãªæ–‡å­—åˆ—ã«åœ§ç¸®ã—ã€å®Ÿè¡Œæ™‚ã«å±•é–‹ã—ã¾ã™ã€‚é™çš„è§£æãƒ„ãƒ¼ãƒ«ã«å¯¾ã—ã¦éå¸¸ã«å¼·åŠ›ã§ã™ã€‚</small>
            </label>
        </div>
        <hr class="border-secondary">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="enableAntiDebug">
            <label class="form-check-label" for="enableAntiDebug">
                <strong>ã‚¢ãƒ³ãƒãƒ‡ãƒãƒƒã‚° (Debug Protection)</strong><br>
                <small class="text-muted">é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãã¨ãƒ–ãƒ©ã‚¦ã‚¶ã‚’åœæ­¢ã•ã›ã¾ã™ï¼ˆå¼·åŠ›ã§ã™ãŒå«Œã‚ã‚Œã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ï¼‰ã€‚</small>
            </label>
        </div>
    </div>

    <div class="d-grid">
        <button id="obfuscateBtn" class="btn btn-primary btn-lg">ğŸ”’ é›£èª­åŒ–ã‚’å®Ÿè¡Œ (Execute)</button>
    </div>
</div>

<!-- 1. é›£èª­åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<script src="https://cdn.jsdelivr.net/npm/javascript-obfuscator/dist/index.browser.js"></script>
<!-- 2. åœ§ç¸®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª (LZ-String) -->
<script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

<script>
    document.getElementById('obfuscateBtn').addEventListener('click', () => {
        const input = document.getElementById('inputCode').value;
        const useLzString = document.getElementById('enableLzString').checked;
        const useAntiDebug = document.getElementById('enableAntiDebug').checked;
        const outputArea = document.getElementById('outputCode');

        if (!input.trim()) {
            alert("ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
        }

        try {
            // --- ç¬¬1æ®µéš: JavaScript Obfuscatorã«ã‚ˆã‚‹è«–ç†çš„é›£èª­åŒ– ---
            const obfuscationResult = JavaScriptObfuscator.obfuscate(input, {
                compact: true,
                controlFlowFlattening: true,
                controlFlowFlatteningThreshold: 1,
                numbersToExpressions: true,
                simplify: true,
                stringArray: true,
                stringArrayEncoding: ['rc4'], // Base64ã‚ˆã‚Šå¼·åŠ›ãªRC4ã‚’ä½¿ç”¨
                stringArrayThreshold: 1,
                splitStrings: true,
                splitStringsChunkLength: 5,
                
                // ã‚¢ãƒ³ãƒãƒ‡ãƒãƒƒã‚°è¨­å®š
                debugProtection: useAntiDebug,
                debugProtectionInterval: useAntiDebug ? 4000 : 0,
                disableConsoleOutput: useAntiDebug,
                
                // è‡ªå·±é˜²è¡›ï¼ˆã‚³ãƒ¼ãƒ‰ãŒæ•´å½¢ã•ã‚Œã‚‹ã¨å‹•ã‹ãªããªã‚‹ï¼‰
                selfDefending: true, 
            });

            let finalCode = obfuscationResult.getObfuscatedCode();

            // --- ç¬¬2æ®µéš: LZ-Stringã«ã‚ˆã‚‹åœ§ç¸®ã‚«ãƒ—ã‚»ãƒ«åŒ– (Shell Layer) ---
            if (useLzString) {
                finalCode = applyLzStringWrapper(finalCode);
            }

            outputArea.value = finalCode;

        } catch (error) {
            console.error(error);
            outputArea.value = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + error.message;
        }
    });

    /**
     * LZ-Stringã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’åœ§ç¸®ã—ã€å®Ÿè¡Œæ™‚ã«å±•é–‹ã™ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½œæˆã™ã‚‹
     * ã“ã‚Œã«ã‚ˆã‚Šã€Webcrackç­‰ã®ASTè§£æãƒ„ãƒ¼ãƒ«ã¯ã€ŒãŸã ã®æ–‡å­—åˆ—ã€ã¨ã—ã‹èªè­˜ã§ããªããªã‚‹
     */
    function applyLzStringWrapper(code) {
        // 1. ã‚³ãƒ¼ãƒ‰ã‚’åœ§ç¸®
        const compressed = LZString.compressToBase64(code);

        // 2. ãƒ©ãƒ³ãƒ€ãƒ ãªå¤‰æ•°åã‚’ç”Ÿæˆï¼ˆè§£æã‚’å°‘ã—ã§ã‚‚é…ã‚‰ã›ã‚‹ãŸã‚ï¼‰
        const varName = '_x' + Math.random().toString(36).substring(7);
        
        // 3. å®Ÿè¡Œç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ (LZStringã®è§£å‡ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€)
        // æ³¨æ„: å®Ÿè¡Œã•ã‚Œã‚‹ç’°å¢ƒã«ã¯LZStringãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ãªã„ã‚ˆã†ã«ã€
        // å¿…è¦ãªãƒ‡ã‚³ãƒ¼ãƒ‰é–¢æ•°(decompressFromBase64ã®è»½é‡ç‰ˆ)ã‚’ã“ã“ã«åŸ‹ã‚è¾¼ã‚€ã‹ã€
        // ç°¡æ˜“çš„ã«CDNã‹ã‚‰èª­ã¿è¾¼ã‚€æ§‹æˆã«ã—ã¾ã™ã€‚
        // ä»Šå›ã¯ã€Œå˜ä½“ã§å‹•ãã€ã“ã¨ã‚’é‡è¦–ã—ã€evalã§å®Ÿè¡Œã™ã‚‹æ§‹æˆã«ã—ã¾ã™ã€‚

        return `
/* Protected by Dual-Layer Obfuscator */
(function(){
    // LZ-Stringã®ç°¡æ˜“å±•é–‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’åŸ‹ã‚è¾¼ã‚€ãŸã‚ã®CDNãƒ­ãƒ¼ãƒ‰ï¼ˆã¾ãŸã¯åŸ‹ã‚è¾¼ã¿ï¼‰
    // å®Ÿéš›ã®æ”»æ’ƒã‚³ãƒ¼ãƒ‰ã£ã½ãè¦‹ãˆãªã„ã‚ˆã†ã«ã€å‹•çš„ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°ã‚’ä½œã‚‹æ‰‹æ³•ã‚’æ¡ç”¨
    var s = document.createElement('script');
    s.src = "https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js";
    s.onload = function() {
        var ${varName} = "${compressed}";
        var decoded = LZString.decompressFromBase64(${varName});
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«æ±šæŸ“ã‚’é˜²ãã¤ã¤å®Ÿè¡Œ (Indirect Eval)
        (1,eval)(decoded);
    };
    document.head.appendChild(s);
})();
`.trim();
    }
</script>

</body>
</html>
