<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ›‘ å¤šå±¤é›£èª­åŒ–ãƒ„ãƒ¼ãƒ« [çœŸãƒ»äººé¡æœ€çµ‚é˜²è¡›ãƒ©ã‚¤ãƒ³ç‰ˆ]</title>
  <style>
    body { font-family: 'Courier New', monospace; background: #000; color: #0f0; padding: 20px; line-height: 1.6; }
    .container { max-width: 1100px; margin: auto; background: #050505; padding: 30px; border-radius: 15px; border: 3px solid #0f0; box-shadow: 0 0 40px #005500; }
    h1 { text-align: center; color: #0f0; text-shadow: 0 0 15px #0f0; font-size: 2.2em; margin-bottom: 5px; }
    .subtitle { text-align: center; color: #8f8; font-size: 0.9em; margin-bottom: 30px; }
    textarea, #output { width: 100%; background: #000; color: #0f0; border: 1px solid #333; border-left: 4px solid #0f0; border-radius: 4px; padding: 15px; font-family: 'Courier New', monospace; font-size: 14px; box-sizing: border-box; }
    textarea { height: 150px; }
    textarea:focus, #output:focus { outline: none; border-color: #0f0; box-shadow: 0 0 10px #030; }
    #output { min-height: 250px; white-space: pre-wrap; word-break: break-all; overflow-y: auto; opacity: 0.8; }
    
    .controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0; }
    button { padding: 12px 25px; font-size: 18px; background: #002200; color: #0f0; border: 1px solid #0f0; border-radius: 5px; cursor: pointer; transition: 0.2s; }
    button:hover { background: #004400; box-shadow: 0 0 15px #0f0; transform: scale(1.05); }
    button:active { transform: scale(0.95); }
    
    .options { background: #0a0a0a; padding: 20px; border-radius: 8px; border: 1px solid #222; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
    label { display: flex; align-items: center; cursor: pointer; user-select: none; }
    input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); accent-color: #0f0; }
    input[type="range"] { accent-color: #0f0; width: 100px; margin: 0 10px; }
    
    .test-area { margin-top: 30px; padding: 20px; border-top: 1px dashed #333; text-align: center; }
    #testResult { font-weight: bold; font-size: 1.2em; display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ›‘ å¤šå±¤é›£èª­åŒ–ãƒ„ãƒ¼ãƒ« <br><span style="font-size:0.6em">[çœŸãƒ»äººé¡æœ€çµ‚é˜²è¡›ãƒ©ã‚¤ãƒ³ç‰ˆ]</span></h1>
    <p class="subtitle">ãƒã‚°ä¿®æ­£æ¸ˆã¿ï¼šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç ´å£Šé˜²æ­¢ / æ•°å€¤å‹ç¶­æŒ / JSONã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å®Ÿè£…</p>

    <textarea id="input" placeholder="ã“ã“ã«ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›...">
// ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ¼ãƒ‰
var secret = 123;
var msg = "Hello World";
console.log(msg, secret + 100);
alert(msg + ": " + (secret * 2));
</textarea>

    <div class="options">
      <div>
        <strong>å±¤æ•°: <input type="range" id="layers" min="1" max="10" value="3"> <span id="layerVal">3</span>å±¤</strong><br>
        <small style="color:#666">â€»å¤šã„ã»ã©èµ·å‹•ãŒé…ããªã‚Šã¾ã™</small>
      </div>
      <label title="å¤‰æ•°ã‚’_0x...ã«å¤‰ãˆã¾ã™ã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£(.logãªã©)ã¯ç„¡è¦–ã—ã¾ã™"><input type="checkbox" id="renameVars" checked> å¤‰æ•°åãƒªãƒãƒ¼ãƒ  (å®‰å…¨ç‰ˆ)</label>
      <label title="æ•°å€¤ã‚’16é€²æ•°ã‚„è¨ˆç®—å¼ã«ã—ã¾ã™"><input type="checkbox" id="numberSafe" checked> æ•°å€¤ã®é›£èª­åŒ– (å‹ç¶­æŒ)</label>
      <label title="æ–‡å­—åˆ—ã‚’\xHHãªã©ã«å¤‰æ›ã—ã¾ã™"><input type="checkbox" id="stringEscape" checked> æ–‡å­—åˆ—ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—</label>
      <label title="ç„¡æ„å‘³ãªè¨ˆç®—ã‚’æŒ¿å…¥ã—ã¾ã™"><input type="checkbox" id="deadCode" checked> ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰çˆ†æ’ƒ</label>
      <label title="ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’eval()ã§å›²ã¿ã¾ã™"><input type="checkbox" id="wrapEval" checked> EvalåŒ…å›² (JSONåœ§ç¸®)</label>
    </div>

    <div class="controls">
      <button onclick="obfuscateMulti()">ğŸ’€ é›£èª­åŒ–å®Ÿè¡Œ</button>
      <button onclick="copy()" style="border-color:#0aa">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
      <button onclick="testRun()" style="border-color:#f55; color:#f55">ğŸš¨ å®Ÿè¡Œãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div class="test-area">
      ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span id="testResult" style="color:#666">å¾…æ©Ÿä¸­...</span>
    </div>

    <pre id="output">ã“ã“ã«æ°¸é ã«èª­ã‚ãªã„ã‚³ãƒ¼ãƒ‰ãŒç”Ÿã¾ã‚Œã‚‹â€¦</pre>
  </div>

<script>
let finalCode = "";

/**
 * 1å±¤åˆ†ã®é›£èª­åŒ–å‡¦ç†
 */
function obfuscateOnce(code) {
  let result = code;

  // -------------------------------------------------------
  // 1. å¤‰æ•°åå®‰å…¨ãƒªãƒãƒ¼ãƒ  (ASTã‚’ä½¿ã‚ãªã„æ­£è¦è¡¨ç¾ã®é™ç•Œã«æŒ‘ã‚€)
  // -------------------------------------------------------
  if (document.getElementById('renameVars').checked) {
    const map = {};
    let varCounter = 0;
    
    // å®£è¨€ã‚’æ¢ã—ã¦ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ä½œæˆ (var/let/const/function ã®ç›´å¾Œ)
    // é™¤å¤–ãƒªã‚¹ãƒˆ: window, document, console ç­‰ã®çµ„ã¿è¾¼ã¿ç³»ã¯å£Šã‚Œã‚‹ã®ã§è§¦ã‚‰ãªã„
    const exclude = ['window', 'document', 'console', 'alert', 'eval', 'setTimeout', 'setInterval', 'location', 'history', 'navigator'];
    
    result = result.replace(/\b(var|let|const|function)\s+([a-zA-Z_$][\w$]*)/g, (match, keyword, name) => {
      if (exclude.includes(name)) return match; // é™¤å¤–ãƒªã‚¹ãƒˆãªã‚‰ã‚¹ãƒ«ãƒ¼
      if (!map[name]) {
        // ãƒ©ãƒ³ãƒ€ãƒ ã‹ã¤ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå¤‰æ•°åã‚’ç”Ÿæˆ
        map[name] = `_0x${Math.floor(Math.random() * 100000).toString(16)}_${(varCounter++).toString(16)}`;
      }
      return `${keyword} ${map[name]}`;
    });

    // ä½œæˆã—ãŸãƒãƒƒãƒ—ã«åŸºã¥ã„ã¦ç½®æ›
    // ã€ä¿®æ­£ç‚¹ã€‘ (?<!\.) ã‚’ä½¿ã„ã€"obj.name" ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ã¯ç½®æ›ã—ãªã„ã‚ˆã†ã«ã™ã‚‹
    // ã“ã‚Œã«ã‚ˆã‚Š console.log ã® log ãŒå¤‰æ•° log ã¨è¢«ã£ã¦ã‚‚ç½®æ›ã•ã‚Œãªããªã‚‹
    for (const [original, obfuscated] of Object.entries(map)) {
      const regex = new RegExp(`(?<!\\.|["'])\\b${original}\\b(?!["'])`, 'g');
      result = result.replace(regex, obfuscated);
    }
  }

  // -------------------------------------------------------
  // 2. æ•°å€¤é›£èª­åŒ– (å‹ãŒå¤‰ã‚ã‚‹å¤‰æ›ã¯æ’é™¤)
  // -------------------------------------------------------
  if (document.getElementById('numberSafe').checked) {
    result = result.replace(/\b(\d+)\b/g, (match) => {
      // æ–‡å­—åˆ—ä¸­ã®æ•°å­—ã‚„ã€ã™ã§ã«å¤‰æ›æ¸ˆã¿ã®æ•°å­—ã‚’é¿ã‘ã‚‹ã®ã¯ç°¡æ˜“æ­£è¦è¡¨ç¾ã§ã¯é™ç•ŒãŒã‚ã‚‹ãŒã€
      // åŸºæœ¬çš„ã«å˜èªå¢ƒç•Œã®æ•°å­—ã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹
      const num = parseInt(match);
      if (isNaN(num) || num < 10) return match; // å°ã•ã„æ•°å­—ã¯ã„ã˜ã‚‰ãªã„æ–¹ãŒå®‰å…¨

      const ways = [
        `0x${num.toString(16)}`,           // 16é€²æ•° (å®‰å…¨)
        `(${num + 1}-1)`,                  // è¨ˆç®—å¼ (å®‰å…¨)
        `(0x${(num).toString(16)}<<0)`,    // ãƒ“ãƒƒãƒˆã‚·ãƒ•ãƒˆ (å®‰å…¨)
        `0b${num.toString(2)}`             // 2é€²æ•° (ES6ä»¥é™)
      ];
      // â€» +[]+num (æ–‡å­—åˆ—åŒ–) ã‚„ [num][0] (undefinedãƒªã‚¹ã‚¯) ã¯å‰Šé™¤ã—ã¾ã—ãŸ
      return ways[Math.floor(Math.random() * ways.length)];
    });
  }

  // -------------------------------------------------------
  // 3. æ–‡å­—åˆ—ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— (å¾©å…ƒå¯èƒ½ãªå½¢å¼)
  // -------------------------------------------------------
  if (document.getElementById('stringEscape').checked) {
    // ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã¨ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆä¸¡å¯¾å¿œ
    result = result.replace(/(["'])(.*?)\1/g, (match, quote, inner) => {
      if (inner.length < 2) return match; // çŸ­ã™ãã‚‹ã®ã¯ç„¡è¦–
      if (inner.includes('\\')) return match; // æ—¢ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒã‚ã‚‹ãªã‚‰è§¦ã‚‰ãªã„(å®‰å…¨ç­–)

      let escaped = '';
      for (let i = 0; i < inner.length; i++) {
        const code = inner.charCodeAt(i);
        // ç¢ºç‡ã§hexåŒ–ã€unicodeåŒ–ã€ãã®ã¾ã¾
        const r = Math.random();
        if (r < 0.5) {
          escaped += '\\x' + code.toString(16).padStart(2, '0');
        } else if (r < 0.8) {
          escaped += '\\u' + code.toString(16).padStart(4, '0');
        } else {
          escaped += inner[i];
        }
      }
      // å®Ÿè¡Œæ™‚ã«æ–‡å­—åˆ—ã¨ã—ã¦çµåˆã—ã¦å¾©å…ƒ
      // ä¾‹: "A" -> ("\x41")
      return `("${escaped}")`;
    });
  }

  // -------------------------------------------------------
  // 4. ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰çˆ†æ’ƒ (å®‰å…¨ãªä½ç½®ã«)
  // -------------------------------------------------------
  if (document.getElementById('deadCode').checked) {
    const junkVars = [];
    for(let i=0; i<3; i++) {
      junkVars.push(`_0x${Math.random().toString(36).substring(2,7)}`);
    }
    // å…ˆé ­ã«å¤‰æ•°ã‚’å®£è¨€ã™ã‚‹ãŒã€æ”¹è¡Œã‚’ã¤ã‘ã¦æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨åˆ†é›¢ã™ã‚‹
    let junk = junkVars.map(v => `var ${v}=${Math.floor(Math.random()*100)};`).join('');
    result = junk + "\n" + result;
  }

  // -------------------------------------------------------
  // 5. Evalã«ã‚ˆã‚‹å®Œå…¨åŒ…å›² (JSON.stringifyã«ã‚ˆã‚‹æœ€å¼·ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—)
  // -------------------------------------------------------
  if (document.getElementById('wrapEval').checked) {
    // ã€ä¿®æ­£ç‚¹ã€‘æ‰‹å‹•replaceã§ã¯ãªãã€JSON.stringifyã‚’ä½¿ã†ã“ã¨ã§
    // å¼•ç”¨ç¬¦ã€æ”¹è¡Œã€ç‰¹æ®Šæ–‡å­—ã‚’å®Œç’§ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦æ–‡å­—åˆ—åŒ–ã™ã‚‹ã€‚
    // ã“ã‚Œã«ã‚ˆã‚Š eval("...") ã®ä¸­ã«å®‰å…¨ã«åã¾ã‚‹ã€‚
    // ä¾‹: eval("console.log(\"hello\")")
    result = `eval(${JSON.stringify(result)})`;
  }

  return result;
}

/**
 * ãƒ¡ã‚¤ãƒ³å‡¦ç†
 */
function obfuscateMulti() {
  let code = document.getElementById('input').value.trim();
  if (!code) {
    alert('ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  const layers = parseInt(document.getElementById('layers').value);
  
  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºãªã©å…¥ã‚ŒãŸã„ãŒã€åŒæœŸå‡¦ç†ãªã®ã§ä¸€ç¬ã§çµ‚ã‚ã‚‹
  try {
    for (let i = 0; i < layers; i++) {
      code = obfuscateOnce(code);
    }
    
    finalCode = code;
    document.getElementById('output').textContent = finalCode;
    
    const resDiv = document.getElementById('testResult');
    resDiv.textContent = "é›£èª­åŒ–å®Œäº†ã€‚å®Ÿè¡Œæº–å‚™OK";
    resDiv.style.color = "#0f0";
    
  } catch (e) {
    alert("é›£èª­åŒ–å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼: " + e.message);
  }
}

/**
 * ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
 */
function testRun() {
  if (!finalCode) return alert('å…ˆã«é›£èª­åŒ–ã—ã¦ãã ã•ã„');

  const resDiv = document.getElementById('testResult');
  resDiv.textContent = "å®Ÿè¡Œä¸­...";
  
  try {
    // console.logã‚’ä¸€æ™‚çš„ã«ä¹—ã£å–ã£ã¦ç”»é¢ã«è¡¨ç¤ºã•ã›ã‚‹ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
    const originalLog = console.log;
    let logs = [];
    console.log = (...args) => {
      logs.push(args.join(' '));
      originalLog.apply(console, args);
    };

    // å®Ÿè¡Œï¼
    const runFunc = new Function(finalCode);
    runFunc();
    
    // å¾©å…ƒ
    console.log = originalLog;

    resDiv.innerHTML = "âœ… å®Ÿè¡ŒæˆåŠŸï¼<br>ãƒ­ã‚°å‡ºåŠ›:<br>" + (logs.length ? logs.join('<br>') : '(ãƒ­ã‚°å‡ºåŠ›ãªã—)');
    resDiv.style.color = "#0f0";
    
  } catch (e) {
    console.error(e);
    resDiv.textContent = "âŒ å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼: " + e.message;
    resDiv.style.color = "#f55";
  }
}

function copy() {
  if(!finalCode) return;
  navigator.clipboard.writeText(finalCode);
  const btn = event.target;
  const origText = btn.textContent;
  btn.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†!";
  setTimeout(() => btn.textContent = origText, 2000);
}

// UIã‚¤ãƒ™ãƒ³ãƒˆ
document.getElementById('layers').addEventListener('input', e => document.getElementById('layerVal').textContent = e.target.value);
</script>
</body>
</html>
