<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obfuscator Pro / Layered Security</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        :root {
            --bg-color: #0f1115;
            --card-bg: #161b22;
            --border-color: #242a32;
            --accent-primary: #6366f1; /* Indigo */
            --accent-hover: #4f46e5;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --code-bg: #0d1117;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        /* Modern Card Styling */
        .glass-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
        }

        h1, h2, h3, h4, h5 { font-weight: 700; letter-spacing: -0.025em; }
        
        /* Custom Code Area */
        .code-editor {
            background-color: var(--code-bg);
            color: #a5d6ff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            resize: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .code-editor:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            outline: none;
            color: #a5d6ff;
            background-color: var(--code-bg);
        }
        .code-editor[readonly] {
            background-color: #0a0c10;
            color: #7ee787;
        }

        /* Buttons */
        .btn-primary-custom {
            background-color: var(--accent-primary);
            border: none;
            color: white;
            font-weight: 600;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .btn-primary-custom:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
        }
        .btn-outline-custom {
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            background: transparent;
        }
        .btn-outline-custom:hover {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Switches */
        .form-switch .form-check-input {
            background-color: #374151;
            border-color: #4b5563;
            cursor: pointer;
        }
        .form-switch .form-check-input:checked {
            background-color: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        .form-check-label {
            font-size: 0.9rem;
            color: var(--text-primary);
            cursor: pointer;
        }
        .setting-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: block;
            margin-top: 2px;
        }

        /* Spinner */
        .spinner-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(22, 27, 34, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 8px;
            backdrop-filter: blur(2px);
        }
    </style>
</head>
<body class="py-5">

<div class="container">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-end mb-4">
        <div>
            <h1 class="mb-1">üõ°Ô∏è Obfuscator <span style="color: var(--accent-primary)">Pro</span></h1>
            <p class="text-secondary mb-0">Multi-Layered JavaScript Protection (Minify + Obfuscate + LZ-Pack)</p>
        </div>
        <a href="https://github.com/" target="_blank" class="btn btn-outline-custom btn-sm">
            <i class="bi bi-github"></i> GitHub
        </a>
    </div>

    <div class="row g-4">
        <!-- Settings Panel -->
        <div class="col-12">
            <div class="glass-card">
                <h5 class="mb-3"><i class="bi bi-sliders"></i> Security Settings</h5>
                <div class="row g-3">
                    <div class="col-md-3 col-sm-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="optAntiDebug" checked>
                            <label class="form-check-label" for="optAntiDebug">Debug Protection</label>
                            <small class="setting-desc">DevTools„ÇíÈñã„Åè„Å®ÂÅúÊ≠¢„Åï„Åõ„Çã</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="optSelfDefending" checked>
                            <label class="form-check-label" for="optSelfDefending">Self Defending</label>
                            <small class="setting-desc">Êï¥ÂΩ¢(PrettierÁ≠â)„ÅßÁ†¥Êêç„Åï„Åõ„Çã</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="optDisableConsole" checked>
                            <label class="form-check-label" for="optDisableConsole">Disable Console</label>
                            <small class="setting-desc">console.logÁ≠â„ÅÆÂá∫Âäõ„ÇíÁÑ°ÂäπÂåñ</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="optDomainLock">
                            <label class="form-check-label" for="optDomainLock">Domain Lock</label>
                            <small class="setting-desc">ÊåáÂÆö„Éâ„É°„Ç§„É≥‰ª•Â§ñ„ÅßÂÆüË°å‰∏çÂèØ„Å´</small>
                        </div>
                        <input type="text" id="domainName" class="form-control form-control-sm mt-2 bg-dark text-light border-secondary" placeholder="ex: mysite.com" style="display:none;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="col-lg-6">
            <div class="glass-card h-100 d-flex flex-column">
                <div class="d-flex justify-content-between mb-2">
                    <label class="fw-bold text-secondary"><i class="bi bi-code-square"></i> Source Code</label>
                    <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary">JavaScript</span>
                </div>
                <textarea id="inputCode" class="form-control code-editor flex-grow-1" rows="14" placeholder="// Paste your code here...
function secret() {
    console.log('Hello World');
}
secret();"></textarea>
            </div>
        </div>

        <!-- Output Area -->
        <div class="col-lg-6">
            <div class="glass-card h-100 d-flex flex-column position-relative">
                <div id="processingOverlay" class="spinner-overlay" style="display: none;">
                    <div class="spinner-border text-primary" role="status"></div>
                </div>

                <div class="d-flex justify-content-between mb-2">
                    <label class="fw-bold text-secondary"><i class="bi bi-box-seam"></i> Obfuscated Output</label>
                    <span class="badge bg-success bg-opacity-10 text-success border border-success">Protected</span>
                </div>
                <textarea id="outputCode" class="form-control code-editor flex-grow-1" rows="14" readonly placeholder="The result will appear here..."></textarea>
                
                <!-- Action Bar -->
                <div class="mt-3 d-flex gap-2">
                    <button id="copyBtn" class="btn btn-outline-custom flex-grow-1">
                        <i class="bi bi-clipboard"></i> Copy
                    </button>
                    <button id="testBtn" class="btn btn-outline-custom flex-grow-1">
                        <i class="bi bi-play-fill"></i> Test Run
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Action -->
    <div class="d-flex justify-content-center mt-5">
        <button id="obfuscateBtn" class="btn btn-primary-custom btn-lg px-5 shadow-lg">
            <i class="bi bi-shield-lock-fill me-2"></i> Obfuscate Code
        </button>
    </div>

</div>

<!-- Toast Notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-check-circle-fill me-2"></i> Copied to clipboard!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/terser/dist/bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/javascript-obfuscator/dist/index.browser.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

<script>
    // UI Logic: Domain Lock Input Toggle
    document.getElementById('optDomainLock').addEventListener('change', function(e) {
        document.getElementById('domainName').style.display = e.target.checked ? 'block' : 'none';
    });

    // Embedded LZ-String Library (Minified v1.5.0)
    // „Åì„Çå„ÇíÂê´„ÇÅ„Çã„Åì„Å®„ÅßÂ§ñÈÉ®‰æùÂ≠ò„ÇíÊéíÈô§
    const LZSTRING_LIB_SOURCE = `var LZString=function(){var r=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e={};function t(r,o){if(!e[r]){e[r]={};for(var n=0;n<r.length;n++)e[r][r.charAt(n)]=n}return e[r][o]}var i={compressToBase64:function(r){if(null==r)return"";var o=i._compress(r,6,function(r){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)});switch(o.length%4){case 0:return o;case 1:return o+"===";case 2:return o+"==";case 3:return o+"="}},decompressFromBase64:function(o){return null==o?"":""==o?null:i._decompress(o.length,32,function(n){return t("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o.charAt(n))})},_compress:function(r,o,n){if(null==r)return"";var e,t,i,a,u,c,f,s,l,p=0,h=0,d="",v="",m=2,g=3;for(i=0;i<r.length;i+=1)if(d=r.charAt(i),Object.prototype.hasOwnProperty.call(e={},d)||(e[d]=g++,t={}),v=d,Object.prototype.hasOwnProperty.call(e,d)){if(256>d.charCodeAt(0)){for(e=0;m>e;e++)p<<=1,h==o-1?(h=0,d+=n(p),p=0):h++;for(f=d.charCodeAt(0),e=0;8>e;e++)p=p<<1|1&f,h==o-1?(h=0,d+=n(p),p=0):h++,f>>=1}else{for(f=1,e=0;m>e;e++)p=p<<1|f,h==o-1?(h=0,d+=n(p),p=0):h++,f=0;for(f=d.charCodeAt(0),e=0;16>e;e++)p=p<<1|1&f,h==o-1?(h=0,d+=n(p),p=0):h++,f>>=1}m--,0==m&&(m=Math.pow(2,a),a++),delete e[d]}else for(f=e[v],e=0;a>e;e++)p=p<<1|1&f,h==o-1?(h=0,d+=n(p),p=0):h++,f>>=1;for(m--,0==m&&(m=Math.pow(2,a),a++),f=2,e=0;a>e;e++)p=p<<1|1&f,h==o-1?(h=0,d+=n(p),p=0):h++,f>>=1;for(;;){if(p<<=1,h==o-1){d+=n(p);break}h++}return d},_decompress:function(o,n,e){var t,i,a,u,c,f,s,l,p=[],h=4,d=4,v=3,m="",g=[],C={val:e(0),position:n,index:1};for(i=0;3>i;i+=1)p[i]=i;for(a=0,c=Math.pow(2,2),f=1;f!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=e(C.index++)),a|=(s>0?1:0)*f,f<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),f=1;f!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=e(C.index++)),a|=(s>0?1:0)*f,f<<=1;l=r(a);break;case 1:for(a=0,c=Math.pow(2,16),f=1;f!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=e(C.index++)),a|=(s>0?1:0)*f,f<<=1;l=r(a);break;case 2:return""}for(p[3]=l,u=l,g.push(l);;){if(C.index>o)return"";for(a=0,c=Math.pow(2,v),f=1;f!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=e(C.index++)),a|=(s>0?1:0)*f,f<<=1;switch(l=a){case 0:for(a=0,c=Math.pow(2,8),f=1;f!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=e(C.index++)),a|=(s>0?1:0)*f,f<<=1;p[d++]=r(a),l=d-1,h--;break;case 1:for(a=0,c=Math.pow(2,16),f=1;f!=c;)s=C.val&C.position,C.position>>=1,0==C.position&&(C.position=n,C.val=e(C.index++)),a|=(s>0?1:0)*f,f<<=1;p[d++]=r(a),l=d-1,h--;break;case 2:return g.join("")}if(0==h&&(h=Math.pow(2,v),v++),p[l])m=p[l];else{if(l!==d)return null;m=u+u.charAt(0)}g.push(m),p[d++]=u+m.charAt(0),h--,u=m,0==h&&(h=Math.pow(2,v),v++)}}};return i}();`;

    // --- Main Logic ---
    document.getElementById('obfuscateBtn').addEventListener('click', async () => {
        const input = document.getElementById('inputCode').value;
        const outputArea = document.getElementById('outputCode');
        const overlay = document.getElementById('processingOverlay');

        // Settings
        const s_antiDebug = document.getElementById('optAntiDebug').checked;
        const s_selfDefending = document.getElementById('optSelfDefending').checked;
        const s_disableConsole = document.getElementById('optDisableConsole').checked;
        const s_domainLock = document.getElementById('optDomainLock').checked;
        const val_domainName = document.getElementById('domainName').value.trim();

        if (!input.trim()) {
            alert("Please enter JavaScript code.");
            return;
        }

        overlay.style.display = 'flex'; // Show spinner
        outputArea.value = ""; // Clear previous

        // Allow UI to update
        await new Promise(r => setTimeout(r, 100));

        try {
            // 0. Pre-process: Domain Lock Injection
            let codeToProcess = input;
            if (s_domainLock && val_domainName) {
                const domainCheck = `if(window.location.hostname !== "${val_domainName}"){ throw new Error("Unauthorized Domain"); }`;
                codeToProcess = domainCheck + "\n" + codeToProcess;
            }

            // 1. Minify (Terser)
            const minifiedResult = await Terser.minify(codeToProcess, {
                mangle: true,
                compress: {
                    drop_console: s_disableConsole // Terser level console drop
                }
            });
            if (minifiedResult.error) throw minifiedResult.error;
            const minifiedCode = minifiedResult.code;

            // 2. Core Obfuscation (Layer 1)
            const coreObfuscation = JavaScriptObfuscator.obfuscate(minifiedCode, {
                compact: true,
                controlFlowFlattening: true,
                controlFlowFlatteningThreshold: 1,
                numbersToExpressions: true,
                simplify: true,
                stringArray: true,
                stringArrayEncoding: ['rc4'],
                stringArrayThreshold: 1,
                
                // Security Settings
                debugProtection: s_antiDebug,
                debugProtectionInterval: s_antiDebug ? 4000 : 0,
                disableConsoleOutput: s_disableConsole,
                selfDefending: s_selfDefending
            }).getObfuscatedCode();

            // 3. Compression (Layer 2)
            const compressedPayload = LZString.compressToBase64(coreObfuscation);

            // 4. Wrapper Construction (Self-Decrypting Loader)
            const wrapperCode = `
                ${LZSTRING_LIB_SOURCE}
                var payload = "${compressedPayload}";
                var decompressed = LZString.decompressFromBase64(payload);
                // Indirect eval to execute in global scope
                (0, eval)(decompressed);
            `;

            // 5. Wrapper Obfuscation (Layer 3 - The Shell)
            const finalResult = JavaScriptObfuscator.obfuscate(wrapperCode, {
                compact: true,
                identifierNamesGenerator: 'mangled',
                renameGlobals: false,
                unicodeEscapeSequence: true, // Makes it look like gibberish
                stringArray: true,
                stringArrayEncoding: ['rc4'],
                stringArrayThreshold: 1,
                splitStrings: true,
                splitStringsChunkLength: 10
            }).getObfuscatedCode();

            outputArea.value = finalResult;

        } catch (error) {
            console.error(error);
            outputArea.value = "Error:\n" + error.message;
        } finally {
            overlay.style.display = 'none';
        }
    });

    // --- Helper: Copy to Clipboard ---
    const toastEl = document.getElementById('liveToast');
    const toast = new bootstrap.Toast(toastEl);

    document.getElementById('copyBtn').addEventListener('click', () => {
        const code = document.getElementById('outputCode').value;
        if(!code) return;
        navigator.clipboard.writeText(code).then(() => {
            toast.show();
        });
    });

    // --- Helper: Test Run ---
    document.getElementById('testBtn').addEventListener('click', () => {
        const code = document.getElementById('outputCode').value;
        if(!code) return;

        const confirmation = confirm("‚ö†Ô∏è Ë≠¶Âëä: Èõ£Ë™≠Âåñ„Åï„Çå„Åü„Ç≥„Éº„Éâ„Çí„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅßÂÆüË°å„Åó„Åæ„Åô„ÄÇ\n\n„ÇÇ„ÅóÁÑ°Èôê„É´„Éº„Éó„ÇÑ„Éñ„É©„Ç¶„Ç∂„ÇØ„É©„ÉÉ„Ç∑„É•„ÇíÂºï„ÅçËµ∑„Åì„Åô„Ç≥„Éº„Éâ„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅ„Çø„Éñ„Åå„Éï„É™„Éº„Ç∫„Åô„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n\nÂÆüË°å„Åó„Åæ„Åô„ÅãÔºü");
        
        if(confirmation) {
            try {
                console.log("--- Test Run Start ---");
                // Indirect eval execution
                (0, eval)(code);
                console.log("--- Test Run End ---");
                alert("ÂÆüË°å„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Ç≥„É≥„ÇΩ„Éº„É´(F12)„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
            } catch(e) {
                alert("ÂÆüË°å„Ç®„É©„Éº: " + e);
                console.error(e);
            }
        }
    });
</script>

</body>
</html>
